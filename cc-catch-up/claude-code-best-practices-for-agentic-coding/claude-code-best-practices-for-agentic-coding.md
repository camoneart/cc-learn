# Claude Code: エージェント型コーディングのベストプラクティス

**公開日:** 2025年4月18日

**原文:** https://www.anthropic.com/engineering/claude-code-best-practices

---

![](https://www-cdn.anthropic.com/images/4zrzovbb/website/6295100fcf8952bed666ba69536c581af87eef15-2554x2554.svg)

Claude Codeは、エージェント型コーディング（agentic coding）のためのコマンドラインツールです。この記事では、さまざまなコードベース、言語、環境でClaude Codeを効果的に使用するために実証済みのヒントやコツを紹介します。

私たちは最近[Claude Codeをリリース](https://www.anthropic.com/news/claude-3-7-sonnet)しました。これは、エージェント型コーディングのためのコマンドラインツールです。研究プロジェクトとして開発されたClaude Codeは、Anthropicのエンジニアや研究者が、Claudeをコーディングワークフローにより自然に統合できる方法を提供します。

Claude Codeは意図的に低レベルで、特定の方針を押し付けないように設計されており、特定のワークフローを強制することなく、モデルへのほぼ直接的なアクセスを提供します。この設計哲学により、柔軟でカスタマイズ可能、スクリプト化可能、かつ安全なパワーツールが実現されています。強力である一方、この柔軟性は、エージェント型コーディングツールに慣れていないエンジニアにとって学習曲線をもたらします。少なくとも、自分なりのベストプラクティスを確立するまでは。

この記事では、Anthropicの社内チームと、さまざまなコードベース、言語、環境でClaude Codeを使用している外部エンジニアの両方にとって効果的であることが証明された一般的なパターンを概説します。このリストの内容は絶対的なものでも普遍的に適用できるものでもありません。これらは出発点としての提案と考えてください。実験して、自分に最適な方法を見つけることをお勧めします！

*より詳細な情報をお探しですか？[claude.ai/code](https://claude.ai/redirect/website.v1.fa7be63b-072d-4a81-a419-32844a7522d0/code)の包括的なドキュメントには、この記事で言及されているすべての機能と、追加の例、実装の詳細、高度なテクニックが記載されています。*

## 1. セットアップをカスタマイズする

Claude Codeは、コンテキストを自動的にプロンプトに取り込むエージェント型コーディングアシスタントです。このコンテキスト収集には時間とトークンを消費しますが、環境の調整によって最適化できます。

### a. `CLAUDE.md`ファイルを作成する

`CLAUDE.md`は、会話を開始するときにClaudeが自動的にコンテキストに取り込む特別なファイルです。これにより、以下のようなことを文書化するのに理想的な場所となります：

- よく使うbashコマンド
- コアファイルとユーティリティ関数
- コードスタイルガイドライン
- テスト手順
- リポジトリのエチケット（例：ブランチ命名規則、マージ vs リベース、など）
- 開発環境のセットアップ（例：pyenvの使用、どのコンパイラが動作するか）
- プロジェクト特有の予期しない動作や警告
- Claudeに覚えておいてほしいその他の情報

`CLAUDE.md`ファイルには決められた形式はありません。簡潔で人間が読みやすい状態を保つことをお勧めします。例えば：

```plaintext
# Bashコマンド
- npm run build: プロジェクトをビルドする
- npm run typecheck: 型チェッカーを実行する

# コードスタイル
- CommonJS (require)ではなく、ESモジュール (import/export) 構文を使用する
- 可能な限りインポートを分割代入する（例：import { foo } from 'bar'）

# ワークフロー
- 一連のコード変更が完了したら、必ず型チェックを行うこと
- パフォーマンスのため、テストスイート全体ではなく単一のテストを実行することを推奨

```

`CLAUDE.md`ファイルは、いくつかの場所に配置できます：

- **リポジトリのルート**、または`claude`を実行する場所（最も一般的な使用法）。`CLAUDE.md`という名前にしてgitにチェックインすることで、セッション間やチームで共有できます（推奨）。または`CLAUDE.local.md`という名前にして`.gitignore`に追加します
- **`claude`を実行するディレクトリの任意の親ディレクトリ**。これはモノレポで最も有用です。`root/foo`から`claude`を実行する場合、`root/CLAUDE.md`と`root/foo/CLAUDE.md`の両方が自動的にコンテキストに取り込まれます
- **`claude`を実行するディレクトリの任意の子ディレクトリ**。これは上記の逆で、この場合、Claudeは子ディレクトリのファイルを操作するときに、必要に応じて`CLAUDE.md`ファイルを取り込みます
- **ホームフォルダ**（`~/.claude/CLAUDE.md`）。これはすべての*claude*セッションに適用されます

`/init`コマンドを実行すると、Claudeは自動的に`CLAUDE.md`を生成します。

### b. `CLAUDE.md`ファイルをチューニングする

`CLAUDE.md`ファイルはClaudeのプロンプトの一部になるため、頻繁に使用されるプロンプトと同じように洗練させる必要があります。よくある間違いは、その効果を反復せずに広範な内容を追加することです。時間をかけて実験し、モデルから最高の指示追従性を生み出すものを決定してください。

手動で`CLAUDE.md`にコンテンツを追加することも、`#`キーを押してClaudeに指示を与え、関連する`CLAUDE.md`に自動的に組み込むこともできます。多くのエンジニアは、コーディング中に`#`を頻繁に使用してコマンド、ファイル、スタイルガイドラインを文書化し、コミットに`CLAUDE.md`の変更を含めることで、チームメンバーも恩恵を受けられるようにしています。

Anthropicでは、時々`CLAUDE.md`ファイルを[prompt improver](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/prompt-improver)に通し、指示の遵守を改善するために指示をチューニングします（例：「IMPORTANT」や「YOU MUST」で強調を追加）。

![Claude Code tool allowlist](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F6961243cc6409e41ba93895faded4f4bc1772366-1600x1231.png&w=3840&q=75)

### c. Claudeの許可されたツールリストをキュレーションする

デフォルトでは、Claude Codeはシステムを変更する可能性のあるあらゆるアクション（ファイルの書き込み、多くのbashコマンド、MCPツールなど）に対して許可を要求します。私たちは意図的にこの保守的なアプローチでClaude Codeを設計し、安全性を優先しています。許可リストをカスタマイズして、安全であることがわかっている追加のツールや、元に戻すのが簡単な潜在的に安全でないツール（例：ファイル編集、`git commit`）を許可できます。

許可されたツールを管理する方法は4つあります：

- セッション中にプロンプトが表示されたときに**「Always allow」を選択**する
- Claude Code起動後に**`/permissions`コマンドを使用**して、許可リストにツールを追加または削除する。例えば、ファイル編集を常に許可するために`Edit`を追加したり、gitコミットを許可するために`Bash(git commit:*)`を追加したり、Puppeteer MCPサーバーでのナビゲーションを許可するために`mcp__puppeteer__puppeteer_navigate`を追加したりできます
- `.claude/settings.json`または`~/.claude.json`を**手動で編集**する（前者をソース管理にチェックインしてチームで共有することをお勧めします）
- セッション固有の許可のために**`--allowedTools` CLIフラグを使用**する

### d. GitHubを使用している場合は、gh CLIをインストールする

ClaudeはIssueの作成、プルリクエストのオープン、コメントの読み取りなど、GitHubとやり取りするために`gh` CLIの使用方法を知っています。`gh`がインストールされていない場合でも、ClaudeはGitHub APIまたはMCPサーバー（インストールされている場合）を使用できます。

## 2. Claudeにより多くのツールを提供する

Claudeは、自分用に構築するのと同じように、便利なスクリプトや関数のセットを構築できるシェル環境にアクセスできます。また、MCPやREST APIを介して、より複雑なツールを活用することもできます。

### a. ClaudeをBashツールと一緒に使用する

Claude Codeはbash環境を継承するため、すべてのツールにアクセスできます。Claudeはunixツールや`gh`などの一般的なユーティリティを知っていますが、指示がなければカスタムbashツールについては知りません：

1. 使用例を含めてツール名をClaudeに伝える
2. ツールのドキュメントを見るために`--help`を実行するようClaudeに伝える
3. 頻繁に使用するツールを`CLAUDE.md`に文書化する

### b. ClaudeをMCPと一緒に使用する

Claude CodeはMCPサーバーとクライアントの両方として機能します。クライアントとして、任意の数のMCPサーバーに接続して、3つの方法でツールにアクセスできます：

- **プロジェクト設定内**（そのディレクトリでClaude Codeを実行するときに利用可能）
- **グローバル設定内**（すべてのプロジェクトで利用可能）
- **チェックインされた`.mcp.json`ファイル内**（コードベースで作業している全員が利用可能）。例えば、`.mcp.json`にPuppeteerとSentryサーバーを追加すると、リポジトリで作業しているすべてのエンジニアがこれらをすぐに使用できるようになります

MCPを操作する際、`--mcp-debug`フラグを付けてClaudeを起動すると、設定の問題を特定するのに役立ちます。

### c. カスタムスラッシュコマンドを使用する

繰り返しのワークフロー（デバッグループ、ログ分析など）のために、`.claude/commands`フォルダ内のMarkdownファイルにプロンプトテンプレートを保存します。これらは、`/`を入力するとスラッシュコマンドメニューから利用できるようになります。これらのコマンドをgitにチェックインして、チームの他のメンバーが利用できるようにすることができます。

カスタムスラッシュコマンドには、コマンド呼び出しからパラメータを渡すための特別なキーワード`$ARGUMENTS`を含めることができます。

例えば、GitHubのissueを自動的に取得して修正するために使用できるスラッシュコマンドは次のとおりです：

```plaintext
GitHubのissueを分析して修正してください：$ARGUMENTS。

次の手順に従ってください：

1. `gh issue view`を使用してissueの詳細を取得する
2. issueに記載されている問題を理解する
3. 関連するファイルをコードベースで検索する
4. issueを修正するために必要な変更を実装する
5. 修正を検証するためのテストを書いて実行する
6. コードがリントと型チェックに合格することを確認する
7. わかりやすいコミットメッセージを作成する
8. プッシュしてPRを作成する

すべてのGitHub関連タスクにはGitHub CLI（`gh`）を使用することを忘れないでください。
```

上記の内容を`.claude/commands/fix-github-issue.md`に置くと、Claude Codeで`/project:fix-github-issue`コマンドとして利用できるようになります。例えば、`/project:fix-github-issue 1234`を使用して、Claudeにissue #1234を修正させることができます。同様に、すべてのセッションで利用可能にしたいコマンドのために、`~/.claude/commands`フォルダに個人用コマンドを追加できます。

## 3. 一般的なワークフローを試す

Claude Codeは特定のワークフローを押し付けず、好きな方法で使用できる柔軟性を提供します。この柔軟性が提供する空間の中で、Claude Codeを効果的に使用するための成功パターンがユーザーコミュニティ全体で浮かび上がっています：

### a. 探索、計画、コード、コミット

この汎用性の高いワークフローは、多くの問題に適しています：

1. **関連するファイル、画像、URLを読むようClaudeに依頼**し、一般的なヒント（「ログを処理するファイルを読んで」）または特定のファイル名（「logging.pyを読んで」）を提供しますが、まだコードを書かないように明示的に伝えます。
   1. 複雑な問題の場合、特にサブエージェントの積極的な使用を検討すべきなのは、ワークフローのこの部分です。会話やタスクの早い段階、特に詳細を検証したり、特定の疑問を調査したりするためにサブエージェントを使用するようClaudeに指示すると、効率性の損失というデメリットがあまりなく、コンテキストの可用性を保つ傾向があります。
2. **特定の問題にアプローチする方法の計画を立てるようClaudeに依頼**します。「think」という言葉を使用して拡張思考モードをトリガーすることをお勧めします。これにより、Claudeに追加の計算時間が与えられ、代替案をより徹底的に評価できます。これらの特定のフレーズは、システム内の思考予算のレベルを上げることに直接マッピングされています：「think」<「think hard」<「think harder」<「ultrathink」。各レベルは、Claudeが使用するための思考予算を段階的に増やします。
   1. このステップの結果が妥当に見える場合、Claudeに計画を含むドキュメントまたはGitHub issueを作成させることで、実装（ステップ3）が望むものでない場合にこの時点にリセットできます。
3. **ソリューションをコードで実装するようClaudeに依頼**します。ここでも、ソリューションの一部を実装する際に、そのソリューションの妥当性を明示的に検証するよう依頼するのも良いでしょう。
4. **結果をコミットしてプルリクエストを作成するようClaudeに依頼**します。関連する場合、これはClaudeにREADMEやchangelogを、実行したことの説明で更新させる良いタイミングでもあります。

ステップ#1-#2は非常に重要です。これらがないと、Claudeは直接ソリューションのコーディングに飛びつく傾向があります。時にはそれが望むことですが、最初に調査と計画をClaudeに依頼すると、事前により深い思考を必要とする問題のパフォーマンスが大幅に向上します。

### b. テストを書いてコミット、コードを書いて反復してコミット

これは、ユニット、統合、またはエンドツーエンドのテストで簡単に検証できる変更に対する、Anthropicのお気に入りのワークフローです。テスト駆動開発（TDD）は、エージェント型コーディングでさらに強力になります：

1. **期待される入出力ペアに基づいてテストを書くようClaudeに依頼**します。テスト駆動開発を行っていることを明示して、コードベースにまだ存在しない機能であっても、モック実装を作成しないようにします。
2. **テストを実行して失敗することを確認するようClaudeに伝えます**。この段階では、実装コードを書かないように明示的に伝えることが役立つことがよくあります。
3. テストに満足したら、**テストをコミットするようClaudeに依頼**します。
4. **テストに合格するコードを書くようClaudeに依頼**し、テストを変更しないように指示します。すべてのテストに合格するまで続けるようClaudeに伝えます。通常、Claudeがコードを書き、テストを実行し、コードを調整し、再度テストを実行するという数回の反復が必要です。
   1. この段階では、実装がテストに過剰適合していないことを独立したサブエージェントで検証するよう依頼すると役立ちます
5. 変更に満足したら、**コードをコミットするようClaudeに依頼**します。

Claudeは、ビジュアルモック、テストケース、またはその他の種類の出力など、反復対象となる明確なターゲットがある場合に最高のパフォーマンスを発揮します。テストのような期待される出力を提供することで、Claudeは変更を加え、結果を評価し、成功するまで段階的に改善できます。

### c. コードを書き、結果をスクリーンショットし、反復する

テストワークフローと同様に、Claudeにビジュアルターゲットを提供できます：

1. **Claudeにブラウザのスクリーンショットを撮る方法を提供**します（例：[Puppeteer MCPサーバー](https://github.com/modelcontextprotocol/servers/tree/c19925b8f0f2815ad72b08d2368f0007c86eb8e6/src/puppeteer)、[iOSシミュレータMCPサーバー](https://github.com/joshuayoes/ios-simulator-mcp)を使用、または手動でスクリーンショットをコピー/ペーストしてClaudeに渡す）。
2. 画像をコピー/ペーストまたはドラッグ&ドロップするか、画像ファイルパスをClaudeに提供することで、**Claudeにビジュアルモックを提供**します。
3. **デザインをコードで実装し、結果のスクリーンショットを撮り、結果がモックと一致するまで反復するようClaudeに依頼**します。
4. 満足したら**コミットするようClaudeに依頼**します。

人間と同様に、Claudeの出力は反復によって大幅に改善される傾向があります。最初のバージョンは良いかもしれませんが、2〜3回の反復後は通常、はるかに良く見えます。最良の結果を得るために、Claudeにその出力を見るツールを提供してください。

![Safe yolo mode](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F6ea59a36fe82c2b300bceaf3b880a4b4852c552d-1600x1143.png&w=3840&q=75)

### d. セーフYOLOモード

Claudeを監視する代わりに、`claude --dangerously-skip-permissions`を使用してすべての権限チェックをバイパスし、Claudeに完了まで中断なしで作業させることができます。これは、リントエラーの修正やボイラープレートコードの生成などのワークフローに適しています。

Claudeに任意のコマンドを実行させることはリスクがあり、データ損失、システム破損、さらにはデータ流出（例：プロンプトインジェクション攻撃による）につながる可能性があります。これらのリスクを最小限に抑えるには、インターネットアクセスのないコンテナで`--dangerously-skip-permissions`を使用してください。Docker Dev Containersを使用した[リファレンス実装](https://github.com/anthropics/claude-code/tree/main/.devcontainer)に従うことができます。

### e. コードベースQ&A

新しいコードベースにオンボーディングするとき、学習と探索のためにClaude Codeを使用します。ペアプログラミング時にプロジェクトの他のエンジニアに尋ねるのと同じ種類の質問をClaudeに尋ねることができます。Claudeはコードベースをエージェント的に検索して、次のような一般的な質問に答えることができます：

- ログはどのように機能しますか？
- 新しいAPIエンドポイントを作成するにはどうすればよいですか？
- `foo.rs`の134行目の`async move { ... }`は何をしますか？
- `CustomerOnboardingFlowImpl`はどのようなエッジケースを処理しますか？
- なぜ333行目で`bar()`の代わりに`foo()`を呼び出しているのですか？
- `baz.py`の334行目のJavaでの同等のものは何ですか？

Anthropicでは、この方法でClaude Codeを使用することがコアオンボーディングワークフローになり、立ち上がり時間が大幅に改善され、他のエンジニアへの負担が軽減されています。特別なプロンプトは必要ありません！単に質問するだけで、Claudeがコードを探索して答えを見つけます。

![Use Claude to interact with git](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2Fa08ea13c2359aac0eceacebf2e15f81e8e8ec8d2-1600x1278.png&w=3840&q=75)

### f. Claudeを使用してgitとやり取りする

Claudeは多くのgit操作を効果的に処理できます。多くのAnthropicエンジニアは、*git*のやり取りの90%以上にClaudeを使用しています：

- **gitの履歴を検索**して、「v1.2.3に入った変更は何ですか？」、「この特定の機能は誰が所有していますか？」、または「このAPIはなぜこのように設計されたのですか？」などの質問に答えます。このようなクエリに答えるために、Claudeにgitの履歴を調べるように明示的にプロンプトすると役立ちます。
- **コミットメッセージを書く**。Claudeは変更と最近の履歴を自動的に調べて、関連するすべてのコンテキストを考慮したメッセージを作成します
- **複雑なgit操作を処理**する。ファイルの復元、リベースの競合の解決、パッチの比較と接ぎ木など

### g. Claudeを使用してGitHubとやり取りする

Claude Codeは多くのGitHubのやり取りを管理できます：

- **プルリクエストの作成**：Claudeは「pr」という省略形を理解し、diffと周囲のコンテキストに基づいて適切なコミットメッセージを生成します。
- **簡単なコードレビューコメントに対するワンショット解決策の実装**：PRのコメントを修正するように伝えるだけで（オプションで、より具体的な指示を与える）、完了したらPRブランチにプッシュバックします。
- **ビルドの失敗やリンター警告の修正**
- **オープンなissueの分類とトリアージ**。オープンなGitHub issueをループで処理するようClaudeに依頼します

これにより、`gh`コマンドライン構文を覚える必要がなくなり、日常的なタスクが自動化されます。

### h. Claudeを使用してJupyterノートブックを操作する

AnthropicのResearchersとデータサイエンティストは、Claude CodeをJupyterノートブックの読み書きに使用しています。Claudeは画像を含む出力を解釈でき、データを探索してやり取りする高速な方法を提供します。必要なプロンプトやワークフローはありませんが、推奨するワークフローは、Claude CodeとVS Codeで`.ipynb`ファイルを並べて開くことです。

Claudeに、同僚に見せる前にJupyterノートブックをクリーンアップしたり、美的改善を加えたりするように依頼することもできます。具体的に、ノートブックやデータ可視化を「美的に魅力的」にするように伝えると、人間の視聴体験のために最適化していることをClaudeに思い出させるのに役立つ傾向があります。

## 4. ワークフローを最適化する

以下の提案はすべてのワークフローに適用されます：

### a. 指示を具体的にする

Claude Codeの成功率は、特に最初の試みで、より具体的な指示で大幅に向上します。最初に明確な指示を与えることで、後で修正する必要性が減ります。

例えば：

| 悪い例 | 良い例 |
| --- | --- |
| foo.pyにテストを追加する | foo.pyの新しいテストケースを書いて、ユーザーがログアウトしているエッジケースをカバーする。モックは避ける |
| なぜExecutionFactoryはこんなに奇妙なAPIなのか？ | ExecutionFactoryのgit履歴を調べて、そのAPIがどのようにして今の形になったのかを要約する |
| カレンダーウィジェットを追加する | ホームページの既存のウィジェットの実装方法を見て、パターンと具体的にコードとインターフェースがどのように分離されているかを理解する。HotDogWidget.phpは始めるのに良い例です。次に、パターンに従って、ユーザーが月を選択し、前後にページネーションして年を選択できる新しいカレンダーウィジェットを実装する。コードベースで既に使用されているもの以外のライブラリを使用せずにゼロから構築する。 |

Claudeは意図を推測できますが、心を読むことはできません。具体性は期待とのより良い整合につながります。

![Give Claude images](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F75e1b57a0b696e7aafeca1ed5fa6ba7c601a5953-1360x1126.png&w=3840&q=75)

### b. Claudeに画像を提供する

Claudeはいくつかの方法で画像や図に優れています：

- **スクリーンショットを貼り付ける**（プロのヒント：macOSで*cmd+ctrl+shift+4*を押してクリップボードにスクリーンショットを撮り、*ctrl+v*で貼り付けます。これは、通常Macで貼り付けに使用するcmd+vではなく、リモートでは機能しないことに注意してください。）
- 画像を**ドラッグ&ドロップ**してプロンプト入力に直接入れる
- 画像の**ファイルパスを提供**する

これは、UI開発の参照ポイントとしてデザインモックを操作する場合や、分析とデバッグのためのビジュアルチャートを操作する場合に特に便利です。コンテキストにビジュアルを追加していない場合でも、結果が視覚的に魅力的であることがどれほど重要かをClaudeに明確にすることが役立ちます。

![Mention files you want Claude to look at or work on](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F7372868757dd17b6f2d3fef98d499d7991d89800-1450x1164.png&w=3840&q=75)

### c. Claudeに見てほしい、または操作してほしいファイルを言及する

タブ補完を使用して、リポジトリ内の任意の場所にあるファイルやフォルダをすばやく参照し、Claudeが適切なリソースを見つけたり更新したりするのを支援します。

![Give Claude URLs](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2Fe071de707f209bbaa7f16b593cc7ed0739875dae-1306x1088.png&w=3840&q=75)

### d. ClaudeにURLを提供する

Claudeが取得して読むために、プロンプトと一緒に特定のURLを貼り付けます。同じドメイン（例：docs.foo.com）の権限プロンプトを避けるために、`/permissions`を使用してドメインを許可リストに追加します。

### e. 早期かつ頻繁に軌道修正する

自動受け入れモード（shift+tabで切り替え）によりClaudeは自律的に作業できますが、通常は積極的なコラボレーターになってClaudeのアプローチを導くことでより良い結果が得られます。最初にタスクをClaudeに徹底的に説明することで最良の結果が得られますが、いつでもClaudeを軌道修正することもできます。

軌道修正に役立つ4つのツールがあります：

- コーディングの前に**Claudeに計画を立てるよう依頼**します。計画が良さそうだと確認するまでコーディングしないように明示的に伝えます。
- **Escapeキーを押してClaudeを中断**する。どのフェーズ（思考中、ツール呼び出し、ファイル編集）でも中断でき、コンテキストを保持しているため、指示をリダイレクトまたは拡張できます。
- **Escapeキーを2回タップして履歴を遡り**、前のプロンプトを編集して、別の方向を探索します。望む結果が得られるまでプロンプトを編集して繰り返すことができます。
- **Claudeに変更を元に戻すよう依頼**します。多くの場合、オプション#2と組み合わせて別のアプローチを取ります。

Claude Codeは時々最初の試みで完璧に問題を解決しますが、これらの修正ツールを使用すると、一般的により良いソリューションをより速く生み出します。

### f. `/clear`を使用してコンテキストを集中させる

長いセッション中、Claudeのコンテキストウィンドウは、無関係な会話、ファイルの内容、コマンドで満たされる可能性があります。これによりパフォーマンスが低下し、時にはClaudeの注意が散漫になることがあります。タスク間で頻繁に`/clear`コマンドを使用して、コンテキストウィンドウをリセットします。

### g. 複雑なワークフローにはチェックリストとスクラッチパッドを使用する

複数のステップや網羅的なソリューションを必要とする大きなタスク（コード移行、多数のリントエラーの修正、複雑なビルドスクリプトの実行など）の場合、Claudeにチェックリストと作業スクラッチパッドとしてMarkdownファイル（またはGitHub issue！）を使用させることでパフォーマンスが向上します：

例えば、多数のリント問題を修正するには、次のようにします：

1. **Claudeにlintコマンドを実行させ**、すべての結果エラー（ファイル名と行番号付き）をMarkdownチェックリストに書き込みます
2. **Claudeに各問題を1つずつ対処するように指示**し、修正と検証を行ってからチェックを付けて次に移動します

### h. Claudeにデータを渡す

Claudeにデータを提供するいくつかの方法があります：

- プロンプトに**直接コピー&ペースト**する（最も一般的なアプローチ）
- **Claude Codeにパイプする**（例：`cat foo.txt | claude`）。ログ、CSV、大量のデータに特に便利
- bashコマンド、MCPツール、またはカスタムスラッシュコマンドを介して**Claudeにデータを取得させる**
- **Claudeにファイルを読ませるか**、URLを取得させる（画像にも機能します）

ほとんどのセッションには、これらのアプローチの組み合わせが含まれます。例えば、ログファイルをパイプインしてから、Claudeにツールを使用して追加のコンテキストを取り込んでログをデバッグするように伝えることができます。

## 5. ヘッドレスモードを使用してインフラを自動化する

Claude Codeには、CI、pre-commitフック、ビルドスクリプト、自動化などの非対話的コンテキストのための[ヘッドレスモード](https://docs.anthropic.com/en/docs/agents-and-tools/claude-code/overview#automate-ci-and-infra-workflows)が含まれています。プロンプトで`-p`フラグを使用してヘッドレスモードを有効にし、`--output-format stream-json`でストリーミングJSON出力を使用します。

ヘッドレスモードはセッション間で持続しないことに注意してください。各セッションでトリガーする必要があります。

### a. issue トリアージにClaudeを使用する

ヘッドレスモードは、リポジトリで新しいissueが作成されたときなど、GitHubイベントによってトリガーされる自動化を強化できます。例えば、公開[Claude Codeリポジトリ](https://github.com/anthropics/claude-code/blob/main/.github/actions/claude-issue-triage-action/action.yml)は、Claudeを使用して新しいissueが入ってくるときに検査し、適切なラベルを割り当てます。

### b. リンターとしてClaudeを使用する

Claude Codeは、従来のリントツールが検出する範囲を超えた[主観的なコードレビュー](https://github.com/anthropics/claude-code/blob/main/.github/actions/claude-code-action/action.yml)を提供でき、タイポ、古いコメント、誤解を招く関数名や変数名などの問題を特定します。

## 6. マルチClaude ワークフローでレベルアップする

単独使用を超えて、最も強力なアプリケーションのいくつかは、複数のClaudeインスタンスを並行して実行することを含みます：

### a. 1つのClaudeにコードを書かせ、別のClaudeに検証させる

シンプルだが効果的なアプローチは、1つのClaudeにコードを書かせ、別のClaudeがレビューまたはテストすることです。複数のエンジニアと作業するのと同様に、時には別々のコンテキストを持つことが有益です：

1. Claudeを使用してコードを書く
2. `/clear`を実行するか、別のターミナルで2つ目のClaudeを起動する
3. 2つ目のClaudeに最初のClaudeの作業をレビューさせる
4. 別のClaudeを起動（または再度`/clear`）して、コードとレビューフィードバックの両方を読ませる
5. このClaudeにフィードバックに基づいてコードを編集させる

テストでも同様のことができます：1つのClaudeにテストを書かせ、次に別のClaudeにテストを合格させるコードを書かせます。Claudeインスタンスに別々の作業スクラッチパッドを与え、どれに書き込むかとどれから読むかを伝えることで、Claudeインスタンスに互いにコミュニケーションを取らせることさえできます。

この分離は、単一のClaudeにすべてを処理させるよりも、しばしばより良い結果をもたらします。

### b. リポジトリの複数のチェックアウトを持つ

Claudeが各ステップを完了するのを待つのではなく、多くのAnthropicエンジニアが行っていることは：

1. **別々のフォルダに3〜4個のgitチェックアウトを作成**する
2. 別々のターミナルタブで**各フォルダを開く**
3. 異なるタスクで**各フォルダでClaudeを起動**する
4. **循環して**進捗を確認し、権限要求を承認/拒否する

### c. git worktreeを使用する

このアプローチは、複数の独立したタスクに対して輝き、複数のチェックアウトに対する軽量な代替手段を提供します。Git worktreeを使用すると、同じリポジトリから複数のブランチを別々のディレクトリにチェックアウトできます。各worktreeには、分離されたファイルを持つ独自の作業ディレクトリがありますが、同じGit履歴とreflogを共有します。

git worktreeを使用すると、プロジェクトの異なる部分で複数のClaudeセッションを同時に実行でき、それぞれが独自の独立したタスクに集中できます。例えば、1つのClaudeに認証システムをリファクタリングさせ、別のClaudeに完全に無関係なデータ可視化コンポーネントを構築させることができます。タスクが重複していないため、各Claudeは互いの変更を待ったりマージの競合に対処したりすることなく、フルスピードで作業できます：

1. **worktreeを作成**：`git worktree add ../project-feature-a feature-a`
2. **各worktreeでClaudeを起動**：`cd ../project-feature-a && claude`
3. 必要に応じて**追加のworktreeを作成**（新しいターミナルタブでステップ1〜2を繰り返す）

いくつかのヒント：

- 一貫した命名規則を使用する
- worktreeごとに1つのターミナルタブを維持する
- MacでiTerm2を使用している場合、Claudeが注意を必要とするときのために[通知を設定](https://docs.anthropic.com/en/docs/agents-and-tools/claude-code/overview#notification-setup)する
- 異なるworktreeに別々のIDEウィンドウを使用する
- 完了したらクリーンアップ：`git worktree remove ../project-feature-a`

### d. カスタムハーネスでヘッドレスモードを使用する

`claude -p`（ヘッドレスモード）は、Claude Codeを組み込みツールとシステムプロンプトを活用しながら、より大きなワークフローにプログラム的に統合します。ヘッドレスモードを使用するための2つの主要なパターンがあります：

1\. **ファンアウト**は、大規模な移行または分析を処理します（例：数百のログでセンチメントを分析したり、数千のCSVを分析したりする）：

1. Claudeにタスクリストを生成するスクリプトを書かせます。例えば、フレームワークAからフレームワークBに移行する必要がある2kファイルのリストを生成します。
2. タスクをループし、それぞれに対してClaudeをプログラム的に呼び出し、タスクと使用できるツールのセットを与えます。例えば：`claude -p "foo.pyをReactからVueに移行する。完了したら、成功した場合は文字列OKを、タスクが失敗した場合はFAILを返す必要があります。" --allowedTools Edit Bash(git commit:*)`
3. スクリプトを数回実行し、プロンプトを洗練させて望む結果を得ます。

2\. **パイプライン化**は、Claudeを既存のデータ/処理パイプラインに統合します：

1. `claude -p "<your prompt>" --json | your_command`を呼び出します。ここで`your_command`は処理パイプラインの次のステップです
2. それだけです！JSON出力（オプション）は、より簡単な自動処理のための構造を提供するのに役立ちます。

これらのユースケースの両方で、Claude呼び出しをデバッグするために`--verbose`フラグを使用すると役立ちます。本番環境では、よりクリーンな出力のためにverboseモードをオフにすることを一般的にお勧めします。

Claude Codeでの作業のヒントとベストプラクティスは何ですか？@AnthropicAIをタグ付けして、あなたが構築しているものを見せてください！

## 謝辞

執筆者：Boris Cherny。この作品は、より広範なClaude Codeユーザーコミュニティのベストプラクティスを基にしており、その創造的なアプローチとワークフローは私たちに刺激を与え続けています。また、Daisy Hollman、Ashwin Bhat、Cat Wu、Sid Bidasaria、Cal Rueb、Nodir Turakulov、Barry Zhang、Drew Hodun、およびClaude Codeでの貴重な洞察と実践的な経験がこれらの推奨事項を形作るのに役立った他の多くのAnthropicエンジニアにも特別な感謝を。

![Interlocking puzzle piece with complex geometric shape and detailed surface texture](https://www-cdn.anthropic.com/images/4zrzovbb/website/43abe7e54b56a891e74a8542944dfbd33f07f49c-1000x1000.svg)

### さらに学びたいですか？

Anthropic Academyのコースで、API開発、Model Context Protocol、Claude Codeをマスターしましょう。修了時には証明書を取得できます。

[コースを探索する](https://anthropic.skilljar.com/)

## 開発者ニュースレターを受け取る

製品アップデート、ハウツー、コミュニティスポットライトなど。毎月受信トレイに配信されます。

毎月の開発者ニュースレターを受け取りたい場合は、メールアドレスを入力してください。いつでも配信を停止できます。
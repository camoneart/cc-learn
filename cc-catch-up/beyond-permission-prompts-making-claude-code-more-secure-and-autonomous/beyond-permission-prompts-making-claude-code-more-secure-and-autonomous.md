# Beyond permission prompts: 許可プロンプトを超えて、Claude Codeをより安全で自律的に

**公開日:** 2025年10月20日

**原文:** https://www.anthropic.com/engineering/claude-code-sandboxing

---

[Engineering at Anthropic](https://www.anthropic.com/engineering)

![](https://www-cdn.anthropic.com/images/4zrzovbb/website/0321b0ecbbf53535e93be1310ae1935157bcebdd-1000x1000.svg)

Claude Codeの新しいサンドボックス機能、bashツール、そしてClaude Code on the webは、ファイルシステムとネットワークの分離という2つの境界を実現することで、許可プロンプトを削減し、ユーザーの安全性を向上させます。

[Claude Code](https://www.claude.com/product/claude-code)では、Claudeがあなたと一緒にコードを書き、テストし、デバッグします。コードベースをナビゲートし、複数のファイルを編集し、コマンドを実行して動作を検証します。Claudeにこれほど多くのアクセス権を与えることは、特にプロンプトインジェクションの場合にリスクをもたらす可能性があります。

これに対処するため、私たちはClaude Codeにサンドボックスをベースとした2つの新機能を導入しました。どちらも、開発者がより安全に作業できる環境を提供しながら、Claudeがより自律的に、より少ない許可プロンプトで実行できるように設計されています。社内での使用では、サンドボックスによって許可プロンプトが84%削減されることがわかりました。Claudeが自由に作業できる明確な境界を定義することで、セキュリティと自律性の両方が向上します。

### **Claude Codeでユーザーの安全を守る**

Claude Codeは許可ベースのモデルで動作します。デフォルトでは読み取り専用で、変更を加えたりコマンドを実行したりする前に許可を求めます。いくつか例外があります。echoやcatのような安全なコマンドは自動的に許可されますが、ほとんどの操作には明示的な承認が必要です。

常に「承認」をクリックすることは開発サイクルを遅くし、「承認疲れ」を引き起こす可能性があります。ユーザーが承認する内容に十分な注意を払わなくなり、結果として開発がより安全でなくなる可能性があります。

これに対処するため、私たちはClaude Code用のサンドボックスを立ち上げました。

## **サンドボックス：より安全で自律的なアプローチ**

サンドボックスは、各アクションごとに許可を求める代わりに、Claudeがより自由に作業できる事前定義された境界を作成します。サンドボックスを有効にすると、許可プロンプトが大幅に減少し、安全性が向上します。

私たちのサンドボックスアプローチは、オペレーティングシステムレベルの機能の上に構築されており、2つの境界を実現します：

1. **ファイルシステム分離**：Claudeが特定のディレクトリのみにアクセスまたは変更できるようにします。これは、プロンプトインジェクションを受けたClaudeが機密性の高いシステムファイルを変更するのを防ぐために特に重要です。
2. **ネットワーク分離**：Claudeが承認されたサーバーにのみ接続できるようにします。これにより、プロンプトインジェクションを受けたClaudeが機密情報を漏洩したり、マルウェアをダウンロードしたりするのを防ぎます。

効果的なサンドボックスには、ファイルシステム分離とネットワーク分離の_両方_が必要であることは注目に値します。ネットワーク分離がなければ、侵害されたエージェントはSSHキーのような機密ファイルを外部に送信できてしまいます。ファイルシステム分離がなければ、侵害されたエージェントは簡単にサンドボックスから脱出してネットワークアクセスを得ることができます。両方の技術を使用することで、Claude Codeユーザーに、より安全で高速なエージェント体験を提供できるのです。

### Claude Codeの2つの新しいサンドボックス機能

#### **サンドボックス化されたbashツール：許可プロンプトなしでの安全なbash実行**

私たちは、ベータ版のリサーチプレビューとして[新しいサンドボックスランタイム](https://docs.claude.com/en/docs/claude-code/sandboxing)を導入しています。これにより、コンテナをスピンアップして管理するオーバーヘッドなしに、エージェントがアクセスできるディレクトリとネットワークホストを正確に定義できます。これは、任意のプロセス、エージェント、MCPサーバーをサンドボックス化するために使用できます。また、[オープンソースのリサーチプレビュー](https://github.com/anthropic-experimental/sandbox-runtime)としても利用可能です。

Claude Codeでは、このランタイムを使用してbashツールをサンドボックス化しています。これにより、Claudeは設定した定義された制限内でコマンドを実行できます。安全なサンドボックス内では、Claudeはより自律的に動作し、許可プロンプトなしでコマンドを安全に実行できます。Claudeがサンドボックスの_外_にあるものにアクセスしようとすると、すぐに通知され、許可するかどうかを選択できます。

私たちは、[Linux bubblewrap](https://github.com/containers/bubblewrap)やMacOS seatbeltなどのOSレベルのプリミティブの上にこれを構築し、これらの制限をOSレベルで強制しています。これらは、Claude Codeの直接的な対話だけでなく、コマンドによって生成されるスクリプト、プログラム、サブプロセスもカバーします。上述のように、このサンドボックスは以下の両方を強制します：

1. **ファイルシステム分離**：現在の作業ディレクトリへの読み書きアクセスを許可しますが、その外部のファイルの変更をブロックします。
2. **ネットワーク分離**：サンドボックスの外部で実行されているプロキシサーバーに接続されたUNIXドメインソケットを通じてのみインターネットアクセスを許可します。このプロキシサーバーは、プロセスが接続できるドメインに対する制限を強制し、新しくリクエストされたドメインに対するユーザー確認を処理します。さらにセキュリティを強化したい場合は、このプロキシをカスタマイズして、送信トラフィックに対する任意のルールを強制することもできます。

両方のコンポーネントは設定可能です：特定のファイルパスやドメインを簡単に許可または禁止できます。

![This image illustrations how sandboxing in Claude Code works.](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2F0d1c612947c798aef48e6ab4beb7e8544da9d41a-4096x2305.png&w=3840&q=75)
Claude Codeのサンドボックスアーキテクチャは、ファイルシステムとネットワークの制御でコード実行を分離し、安全な操作を自動的に許可し、悪意のある操作をブロックし、必要なときだけ許可を求めます。

サンドボックスにより、プロンプトインジェクションが成功しても完全に分離され、ユーザー全体のセキュリティに影響を与えることはありません。この方法により、侵害されたClaude CodeはSSHキーを盗んだり、攻撃者のサーバーに情報を送信したりすることができません。

この機能を使い始めるには、Claude Codeで `/sandbox` を実行し、私たちのセキュリティモデルに関する[より詳細な技術情報](https://docs.claude.com/en/docs/claude-code/sandboxing)をチェックしてください。

他のチームがより安全なエージェントを構築しやすくするために、私たちはこの機能をオープンソース化しました。他の人々も、エージェントのセキュリティ体制を強化するために、この技術を自分たちのエージェントに採用することを検討すべきだと考えています。

#### **Claude Code on the web：クラウドでClaude Codeを安全に実行**

本日、私たちは[Claude Code on the web](https://docs.claude.com/en/docs/claude-code/claude-code-on-the-web)もリリースし、ユーザーがクラウド内の分離されたサンドボックスでClaude Codeを実行できるようにしました。Claude Code on the webは、各Claude Codeセッションを分離されたサンドボックスで実行し、安全で確実な方法でサーバーへのフルアクセスを提供します。このサンドボックスは、Git認証情報や署名キーなどの機密性の高い認証情報がClaude Codeとともにサンドボックス内に決して存在しないように設計されています。これにより、サンドボックス内で実行されているコードが侵害された場合でも、ユーザーはさらなる被害から保護されます。

Claude Code on the webは、すべてのGit操作を透過的に処理するカスタムプロキシサービスを使用します。サンドボックス内では、Gitクライアントはカスタムビルドされたスコープ付き認証情報を使用してこのサービスに認証します。プロキシは、この認証情報とGit操作の内容（例：設定されたブランチにのみプッシュしていることを確認）を検証してから、GitHubにリクエストを送信する前に適切な認証トークンを付加します。

![This illustration depicts how Claude Code on the web uses a custom proxy to handle all git interactions.](https://www.anthropic.com/_next/image?url=https%3A%2F%2Fwww-cdn.anthropic.com%2Fimages%2F4zrzovbb%2Fwebsite%2Fe8f66bcf73d9d23cae67e67776b2d31373c13050-4096x2305.png&w=3840&q=75)
Claude CodeのGit統合は、認証トークン、ブランチ名、リポジトリの宛先を検証する安全なプロキシを通じてコマンドをルーティングし、安全なバージョン管理ワークフローを可能にしながら、不正なプッシュを防ぎます。

## 始め方

私たちの新しいサンドボックス化されたbashツールとClaude Code on the webは、エンジニアリング作業にClaudeを使用する開発者にとって、セキュリティと生産性の両面で大幅な改善を提供します。

これらのツールを使い始めるには：

1. Claudeで `/sandbox` を実行し、このサンドボックスの設定方法に関する[ドキュメント](https://docs.claude.com/en/docs/claude-code/sandboxing)をチェックしてください。
2. [claude.com/code](http://claude.ai/redirect/website.v1.889f1803-0be3-468d-9b21-80f01fe2f7c9/code)にアクセスして、Claude Code on the webを試してください。

または、自分でエージェントを構築している場合は、[オープンソース化されたサンドボックスコード](https://github.com/anthropic-experimental/sandbox-runtime)をチェックし、作業に統合することを検討してください。皆さんが何を構築するか楽しみにしています。

Claude Code on the webの詳細については、[リリースブログ投稿](https://www.anthropic.com/news/claude-code-on-the-web)をチェックしてください。

## 謝辞

記事はDavid DworkenとOliver Weller-Daviesが執筆し、Catherine Wu、Molly Vorwerck、Alex Isken、Kier Bradwell、Kevin Garciaが貢献しました。

## 開発者ニュースレターを購読

製品アップデート、ハウツー、コミュニティスポットライトなど。月次でお届けします。

月次の開発者ニュースレターを受け取りたい場合は、メールアドレスを提供してください。いつでも購読解除できます。
